# 智能小车自动控制系统

这是一个基于 ROS2、YOLO 和 OpenCV 的智能小车自动控制系统,可以实现自动寻找和抓取指定颜色的球体。

## 功能特点

- 支持自动/手动模式切换
- 基于 YOLO 的实时目标检测
- 多颜色球体识别与优先级处理
- 精确的距离测量与运动控制
- 串口通信控制底层驱动
- 支持手柄/摇杆控制

## 系统要求

- Python 3.8+
- ROS2 
- PyTorch
- CUDA (推荐用于 YOLO 加速)
- OpenCV
- Pygame (用于手柄控制)
- Ultralytics YOLO
- PySerial

## 安装说明

1. 安装所需的 Python 包:
```bash
pip install torch opencv-python pygame pyserial ultralytics
```

2. 安装 ROS2 并配置环境

3. 克隆本项目到工作空间

4. 编译工作空间:
colcon build

## 使用说明

1. 启动 ROS2 环境:

source /opt/ros/<ros-distro>/setup.bash

2. 运行主程序:
```bash
python3 all.py
```

### 操作模式

- **自动模式**: 系统默认启动为自动模式
- **手动模式**: 按下手柄左肩键(LB)切换到手动模式
- **返回自动**: 按下手柄右肩键(RB)返回自动模式

### 控制命令

- 前进: `1`
- 左转: `2`
- 右转: `3`
- 后退: `4`
- 停止: `5`
- 夹取: `X`
- 释放: `Y`

## 配置参数

主要配置参数位于 `all.py` 文件开头:

- `ERROR_FACTOR`: 误差容忍度 (1-10)
- `BACKWARD_DURATION`: 后退持续时间
- `RIGHT_TURN_DURATION`: 右转持续时间
- `SEARCH_COLOR`: 搜索的球的颜色
- `COLOR_PRIORITY`: 颜色优先级列表

## 项目结构

- `all.py`: 主程序文件
- `automatic.py`: 自动控制模式核心逻辑
- `README.md`: 项目说明文档

## 主要类说明

### ImageSubscriber
ROS2 图像订阅器,负责接收并处理来自相机的图像数据。

### YOLOProcessor
YOLO 目标检测处理器,用于实时检测图像中的球体目标。

### JoystickController
手柄控制器,处理手柄输入并转换为控制命令。

### AutomaticProcessor
自动模式处理器,实现了以下核心功能:
- 目标检测与跟踪
- 颜色识别与分类
- 运动控制决策
- 自动抓取与释放

## 工作流程

1. **初始化阶段**
   - 加载 YOLO 模型
   - 初始化 ROS2 节点
   - 建立串口连接
   - 配置相机参数

2. **自动模式**
   - 实时目标检测
   - 颜色优先级判断
   - 距离测量
   - 运动控制
   - 自动抓取/释放

3. **手动模式**
   - 手柄输入处理
   - 直接运动控制
   - 手动抓取/释放

## 调试与优化

### 参数调整
- 调整 `confidence_threshold` 以平衡检测准确度和灵敏度
- 修改 `target_distance` 以适应不同的抓取距离需求
- 通过 `error_factor` 调整运动控制的精确度

### 常见问题
1. 检测不稳定
   - 检查光照条件
   - 调整相机参数
   - 提高 confidence_threshold

2. 运动控制不准确
   - 校准相机参数
   - 调整 error_factor
   - 检查串口通信

3. 抓取失败
   - 确认目标距离设置
   - 检查机械臂控制
   - 调整抓取时序

## 注意事项

1. 使用前请确保已正确配置串口设备名称
2. 确保 YOLO 模型文件 (.pt) 位于正确路径
3. 相机参数需要根据实际硬件进行调整
4. 运行时需要连接摄像头和手柄设备
5. 首次运行前建议进行相机标定
6. 定期检查并更新依赖包版本

## 维护与更新

### 版本历史
- v1.0.0: 初始版本
  - 基础功能实现
  - 自动/手动模式切换
  - 基本目标检测与抓取

### 计划功能
- [ ] 多目标并行跟踪
- [ ] 动态路径规划
- [ ] 障碍物避免
- [ ] 深度学习优化
- [ ] 网络远程控制

## 许可证

MIT License

## 贡献指南

1. Fork 本仓库
2. 创建特性分支
3. 提交更改
4. 发起 Pull Request

欢迎提交 Issue 和 Pull Request 来帮助改进项目。

## 联系方式

如有问题请提交 Issue 或发起讨论。

## 致谢

感谢所有为本项目做出贡献的开发者。

---

**注**: 本文档会随项目发展持续更新,请定期检查最新版本。